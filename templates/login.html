<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>–í—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body { background: #f8f6ff; }
      .card { border: none; border-radius: 1.5rem; }
      .btn-purple {
        background: linear-gradient(90deg, #7c3aed 0%, #a78bfa 100%);
        color: #fff;
        border: none;
        border-radius: 2rem;
        font-weight: 600;
        box-shadow: 0 2px 8px rgba(124,58,237,0.08);
        transition: background 0.2s;
      }
      .btn-purple:hover {
        background: linear-gradient(90deg, #a78bfa 0%, #7c3aed 100%);
        color: #fff;
      }
      .card-title {
        color: #7c3aed;
        font-weight: 700;
      }
      a { color: #7c3aed; }
      a:hover { color: #4c1d95; }
      .input-group-text { cursor: pointer; }
      /* --- –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å --- */
      @media (max-width: 768px) {
        .container, .container-fluid { padding: 0 5px !important; }
        .card { border-radius: 1rem; }
        .card-title { font-size: 1.2rem; }
        .btn, .btn-purple { font-size: 1rem; padding: 10px 0; }
      }
      @media (max-width: 480px) {
        .card { border-radius: 0.5rem; }
        .card-title { font-size: 1rem; }
        .btn, .btn-purple { font-size: 0.95rem; }
      }
    </style>
  </head>
  <body>
    <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
    <div style="position: absolute; top: 24px; right: 40px; z-index: 1000;">
      <div class="form-check form-switch d-flex align-items-center">
        <input class="form-check-input" type="checkbox" id="themeSwitch">
        <label class="form-check-label ms-2" for="themeSwitch" id="themeSwitchLabel">–¢—ë–º–Ω–∞—è —Ç–µ–º–∞</label>
      </div>
    </div>
    <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —è–∑—ã–∫–∞ -->
    <div id="langSwitcher" style="position:fixed;left:20px;bottom:20px;z-index:2000;">
      <button class="btn btn-light dropdown-toggle d-flex align-items-center" type="button" id="langDropdown" data-bs-toggle="dropdown" aria-expanded="false">
        <span id="langFlag">üá∑üá∫</span> <span id="langLabel" class="ms-2">RU</span>
      </button>
      <ul class="dropdown-menu" aria-labelledby="langDropdown">
        <li><a class="dropdown-item lang-option" href="#" data-lang="ru"><span class="me-2">üá∑üá∫</span>–†—É—Å—Å–∫–∏–π</a></li>
        <li><a class="dropdown-item lang-option" href="#" data-lang="en"><span class="me-2">üá¨üáß</span>English</a></li>
      </ul>
    </div>
    <div class="container py-5">
      <div class="row justify-content-center">
        <div class="col-md-5">
          <div class="card shadow-sm">
            <div class="card-body">
              <h1 class="card-title mb-4 text-center">–í—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h1>
              {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                  {% for category, message in messages %}
                    <div class="alert alert-{{ 'success' if category=='success' else 'danger' if category=='error' else 'info' if category=='info' else 'warning' if category=='warning' else 'primary' }}">
                      {{ message }}
                    </div>
                  {% endfor %}
                {% endif %}
              {% endwith %}
              <ul class="nav nav-tabs mb-3" id="authTabs" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button" role="tab" aria-controls="login" aria-selected="true">–í–æ–π—Ç–∏</button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="register-tab" data-bs-toggle="tab" data-bs-target="#register" type="button" role="tab" aria-controls="register" aria-selected="false">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</button>
                </li>
              </ul>
              <div class="tab-content" id="authTabsContent">
                <div class="tab-pane fade show active" id="login" role="tabpanel" aria-labelledby="login-tab">
                  <form method="post" id="loginForm">
                    <div class="mb-3">
                      <label for="login-username" class="form-label">–õ–æ–≥–∏–Ω</label>
                      <input type="text" class="form-control" id="login-username" name="username" required>
                    </div>
                    <div class="mb-3">
                      <label for="login-password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                      <div class="input-group">
                        <input type="password" class="form-control" id="login-password" name="password" required>
                        <span class="input-group-text" id="toggle-login-password"><i class="fa fa-eye"></i></span>
                      </div>
                    </div>
                    <button type="submit" class="btn btn-purple w-100">–í–æ–π—Ç–∏</button>
                  </form>
                </div>
                <div class="tab-pane fade" id="register" role="tabpanel" aria-labelledby="register-tab">
                  <form id="registerForm">
                    <div class="mb-3">
                      <label for="register-username" class="form-label">–õ–æ–≥–∏–Ω</label>
                      <input type="text" class="form-control" id="register-username" name="username" required>
                    </div>
                    <div class="mb-3">
                      <label for="register-password" class="form-label">–ü–∞—Ä–æ–ª—å</label>
                      <div class="input-group">
                        <input type="password" class="form-control" id="register-password" name="password" required>
                        <span class="input-group-text" id="toggle-register-password"><i class="fa fa-eye"></i></span>
                      </div>
                    </div>
                    <button type="submit" class="btn btn-purple w-100">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ —Ç–µ–º—ã
      function setTheme(theme) {
        if (theme === 'dark') {
          document.documentElement.setAttribute('data-theme', 'dark');
          localStorage.setItem('theme', 'dark');
          document.getElementById('themeSwitch').checked = true;
          document.getElementById('themeSwitchLabel').textContent = '—Å–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
        } else {
          document.documentElement.setAttribute('data-theme', 'light');
          localStorage.setItem('theme', 'light');
          document.getElementById('themeSwitch').checked = false;
          document.getElementById('themeSwitchLabel').textContent = '—Ç—ë–º–Ω–∞—è —Ç–µ–º–∞';
        }
      }
      // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      setTheme(localStorage.getItem('theme') || 'light');
      // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—è
      document.getElementById('themeSwitch').addEventListener('change', function() {
        setTheme(this.checked ? 'dark' : 'light');
      });
      // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ fetch
      document.getElementById('registerForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        const username = document.getElementById('register-username').value;
        const password = document.getElementById('register-password').value;
        const response = await fetch("{{ url_for('register') }}", {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: new URLSearchParams({ username, password })
        });
        if (response.redirected) {
          window.location.href = response.url;
        } else {
          window.location.reload();
        }
      });
      // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å (–≤—Ö–æ–¥)
      document.getElementById('toggle-login-password').addEventListener('click', function() {
        const input = document.getElementById('login-password');
        const icon = this.querySelector('i');
        if (input.type === 'password') {
          input.type = 'text';
          icon.classList.remove('fa-eye');
          icon.classList.add('fa-eye-slash');
        } else {
          input.type = 'password';
          icon.classList.remove('fa-eye-slash');
          icon.classList.add('fa-eye');
        }
      });
      // –ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è)
      document.getElementById('toggle-register-password').addEventListener('click', function() {
        const input = document.getElementById('register-password');
        const icon = this.querySelector('i');
        if (input.type === 'password') {
          input.type = 'text';
          icon.classList.remove('fa-eye');
          icon.classList.add('fa-eye-slash');
        } else {
          input.type = 'password';
          icon.classList.remove('fa-eye-slash');
          icon.classList.add('fa-eye');
        }
      });
      // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–µ –ø–æ–ª–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏
      function setFocus(tab) {
        if (tab === 'login') {
          document.getElementById('login-username').focus();
        } else if (tab === 'register') {
          document.getElementById('register-username').focus();
        }
      }
      // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∞–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ª–æ–≥–∏–Ω
      setFocus('login');
      // –ü—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –≤–∫–ª–∞–¥–æ–∫ –∞–≤—Ç–æ—Ñ–æ–∫—É—Å
      document.getElementById('login-tab').addEventListener('shown.bs.tab', function() { setFocus('login'); });
      document.getElementById('register-tab').addEventListener('shown.bs.tab', function() { setFocus('register'); });
      // –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
      const translations = {
        ru: {
          loginTitle: '–í—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è',
          loginTab: '–í–æ–π—Ç–∏',
          regTab: '–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è',
          username: '–õ–æ–≥–∏–Ω',
          password: '–ü–∞—Ä–æ–ª—å',
          loginBtn: '–í–æ–π—Ç–∏',
          regBtn: '–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è',
          already: '–£–∂–µ –µ—Å—Ç—å –∞–∫–∫–∞—É–Ω—Ç? –í–æ–π—Ç–∏',
          noacc: '–ù–µ—Ç –∞–∫–∫–∞—É–Ω—Ç–∞? –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è',
          show: '–ü–æ–∫–∞–∑–∞—Ç—å',
          hide: '–°–∫—Ä—ã—Ç—å',
          theme: '–¢—ë–º–Ω–∞—è —Ç–µ–º–∞',
          error: '–û—à–∏–±–∫–∞',
        },
        en: {
          loginTitle: 'Login & Registration',
          loginTab: 'Login',
          regTab: 'Register',
          username: 'Username',
          password: 'Password',
          loginBtn: 'Login',
          regBtn: 'Sign up',
          already: 'Already have an account? Login',
          noacc: 'No account? Register',
          show: 'Show',
          hide: 'Hide',
          theme: 'Dark theme',
          error: 'Error',
        }
      };
      function setLang(lang) {
        localStorage.setItem('lang', lang);
        document.getElementById('langLabel').textContent = lang.toUpperCase();
        document.getElementById('langFlag').textContent = lang === 'ru' ? 'üá∑üá∫' : 'üá¨üáß';
        document.querySelector('.card-title').textContent = translations[lang].loginTitle;
        document.getElementById('login-tab').textContent = translations[lang].loginTab;
        document.getElementById('register-tab').textContent = translations[lang].regTab;
        document.querySelectorAll('label[for="login-username"], label[for="register-username"]').forEach(l => l.textContent = translations[lang].username);
        document.querySelectorAll('label[for="login-password"], label[for="register-password"]').forEach(l => l.textContent = translations[lang].password);
        document.querySelector('#loginForm button[type="submit"]').textContent = translations[lang].loginBtn;
        document.querySelector('#registerForm button[type="submit"]').textContent = translations[lang].regBtn;
        document.querySelectorAll('.nav-link').forEach((el, i) => {
          if (i === 0) el.textContent = translations[lang].loginTab;
          if (i === 1) el.textContent = translations[lang].regTab;
        });
        document.querySelectorAll('.mt-3.text-center a').forEach(a => {
          if (a.getAttribute('href') === "{{ url_for('login') }}") a.textContent = translations[lang].already;
          if (a.getAttribute('href') === "{{ url_for('register') }}") a.textContent = translations[lang].noacc;
        });
      }
      document.querySelectorAll('.lang-option').forEach(el => {
        el.addEventListener('click', function(e) {
          e.preventDefault();
          setLang(this.dataset.lang);
        });
      });
      setLang(localStorage.getItem('lang') || 'ru');
    </script>
  </body>
</html> 